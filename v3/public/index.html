<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Family Ramadan tracker â€” taraweeh, quran, fasting, azkar, surah memorization, namaz">
    <title>RamadanFlow</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ•Œ</text></svg>">
    <link rel="stylesheet" href="/style.css">
</head>

<body>

    <!-- ============================================================= -->
    <!-- LOGIN PAGE -->
    <!-- ============================================================= -->
    <div class="page-wrapper" id="loginWrapper">
        <div class="auth-container">
            <div class="auth-card">
                <div class="logo">
                    <span class="icon">ğŸ•Œ</span>
                    <h1>RamadanFlow</h1>
                    <p>Family Ramadan Progress</p>
                </div>
                <div id="loginAlert" class="alert"></div>
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Email or Username</label>
                        <input type="text" id="identifier" placeholder="Enter email or username" required
                            autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter password" required
                            autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn btn-primary" id="loginBtn">Sign In</button>
                </form>
                <div class="auth-link">
                    Don't have an account? <a href="#" onclick="goToPage('Register')">Register</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================================= -->
    <!-- REGISTER PAGE -->
    <!-- ============================================================= -->
    <div class="page-wrapper" id="registerWrapper" style="display:none">
        <div class="auth-container">
            <div class="auth-card">
                <div class="logo">
                    <span class="icon">ğŸ•Œ</span>
                    <h1>RamadanFlow</h1>
                    <p>Join your family's Ramadan journey</p>
                </div>
                <div id="registerAlert" class="alert"></div>
                <form id="registerForm" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="regUsername" placeholder="e.g. First_Name Middle_Name Last_Name" required
                            minlength="3" autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="regEmail" placeholder="your@email.com" required autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="regPassword" placeholder="At least 4 characters" required
                            minlength="4" autocomplete="new-password">
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="regConfirmPassword" placeholder="Re-enter password" required
                            autocomplete="new-password">
                    </div>
                    <button type="submit" class="btn btn-primary" id="registerBtn">Create Account</button>
                </form>
                <div class="auth-link">
                    Already have an account? <a href="#" onclick="goToPage('Login')">Sign In</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================================= -->
    <!-- DASHBOARD -->
    <!-- ============================================================= -->
    <div class="page-wrapper" id="dashboardWrapper" style="display:none">

        <!-- HEADER -->
        <header class="header">
            <div class="header-left">
                <span class="icon">ğŸ•Œ</span>
                <h1>RamadanFlow</h1>
            </div>
            <div class="header-right">
                <select id="yearSelect" onchange="changeYear()">
                    <script>
                        var cy = new Date().getFullYear();
                        for (var y = cy + 1; y >= cy - 5; y--) {
                            document.write('<option value="' + y + '"' + (y === cy ? ' selected' : '') + '>' + y + '</option>');
                        }
                    </script>
                </select>
                <div class="user-badge" onclick="openProfile()">
                    <span>ğŸ‘¤ <span id="displayName"></span></span>
                    <span class="role" id="displayRole"></span>
                </div>
                <button class="btn btn-secondary btn-sm" onclick="logout()">Logout</button>
            </div>
        </header>

        <!-- QUICK STATS -->
        <div class="main-content">
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-value" id="statTaraweeh">-</div>
                    <div class="stat-label">ğŸ•Œ Taraweeh</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statStreak">-</div>
                    <div class="stat-label">ğŸ”¥ Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statParas">-</div>
                    <div class="stat-label">ğŸ“– Paras</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statKhatams">-</div>
                    <div class="stat-label">âœ… Khatams</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statFasting">-</div>
                    <div class="stat-label">ğŸ½ï¸ Fasts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statAzkar">-</div>
                    <div class="stat-label">ğŸ“¿ Azkar</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statNamaz">-</div>
                    <div class="stat-label">ğŸ•Œ Namaz</div>
                </div>
            </div>

            <!-- SKELETON -->
            <div id="skeletonArea" style="display:none"></div>

            <!-- ADMIN EDIT BANNER -->
            <div id="adminEditBanner"
                style="display:none;background:rgba(201,168,76,0.15);border:1px solid var(--gold);border-radius:var(--radius-sm);padding:12px 16px;margin-bottom:16px;align-items:center;justify-content:space-between">
                <span>ğŸ‘‘ Editing as: <strong id="adminEditName"></strong></span>
                <button class="btn btn-secondary btn-sm" onclick="exitAdminEdit()">â† Back to My Data</button>
            </div>

            <!-- TABS -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="taraweeh" onclick="switchTab('taraweeh')">ğŸ•Œ Taraweeh</button>
                <button class="tab-btn" data-tab="quran" onclick="switchTab('quran')">ğŸ“– Quran</button>
                <button class="tab-btn" data-tab="fasting" onclick="switchTab('fasting')">ğŸ½ï¸ Fasting</button>
                <button class="tab-btn" data-tab="azkar" onclick="switchTab('azkar')">ğŸ“¿ Azkar</button>
                <button class="tab-btn" data-tab="surah" onclick="switchTab('surah')">ğŸ“ Surah</button>
                <button class="tab-btn" data-tab="namaz" onclick="switchTab('namaz')">ğŸ•Œ Namaz</button>
                <button class="tab-btn" data-tab="stats" onclick="switchTab('stats')">ğŸ“Š Stats</button>
                <button class="tab-btn" data-tab="admin" id="adminTabBtn" style="display:none"
                    onclick="switchTab('admin')">ğŸ‘‘ Admin</button>
            </div>

            <!-- TAB: TARAWEEH -->
            <div class="tab-content active" id="tab-taraweeh">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ•Œ Taraweeh Calendar</h2>
                        <p style="font-size:13px;color:var(--text-secondary)">Click a date to log prayer</p>
                    </div>
                    <div class="calendar">
                        <div class="calendar-nav">
                            <button onclick="prevMonth()">â—€</button>
                            <h3 id="taraweehMonthTitle"></h3>
                            <button onclick="nextMonth()">â–¶</button>
                        </div>
                        <div class="calendar-grid" id="taraweehCalendar"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: QURAN -->
            <div class="tab-content" id="tab-quran">
                <div class="card">
                    <div class="card-header" style="align-items:center;">
                        <h2>ğŸ“– Quran Progress</h2>
                        <div style="display:flex;gap:8px">
                            <button class="btn btn-primary btn-sm" onclick="startNewKhatam('Arabic')">+ Arabic</button>
                            <button class="btn btn-secondary btn-sm" onclick="startNewKhatam('Translation')">+
                                Translation</button>
                        </div>
                    </div>
                    <p style="font-size:13px;color:var(--text-secondary);margin-bottom:16px">
                        Click para numbers to toggle. Start unlimited khatams â€” Arabic or Translation.
                    </p>
                    <div id="khatamList"></div>
                </div>
            </div>

            <!-- TAB: FASTING -->
            <div class="tab-content" id="tab-fasting">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ½ï¸ Fasting Tracker</h2>
                        <p style="font-size:13px;color:var(--text-secondary)">Click a date to toggle</p>
                    </div>
                    <div class="calendar">
                        <div class="calendar-nav">
                            <button onclick="prevFastingMonth()">â—€</button>
                            <h3 id="fastingMonthTitle"></h3>
                            <button onclick="nextFastingMonth()">â–¶</button>
                        </div>
                        <div class="calendar-grid" id="fastingCalendar"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: AZKAR -->
            <div class="tab-content" id="tab-azkar">
                <div class="card"
                    style="margin-bottom:16px; background: rgba(201,168,76,0.1); border-left: 4px solid var(--gold);">
                    <div style="padding: 16px;">
                        <h2 style="font-size: 16px; margin-bottom: 8px;">âœ¨ Daily Authentic Dhikr</h2>
                        <div id="dailyDhikrText" style="margin-bottom: 8px;">
                            <p style="font-size: 14px; font-style: italic; color: var(--text-primary);">Loading daily
                                dhikr...</p>
                        </div>
                        <p id="dailyDhikrRef" style="font-size: 12px; color: var(--text-secondary); text-align: right;">
                            -</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ“¿ Daily Azkar</h2>
                        <p style="font-size:13px;color:var(--text-secondary)">Tap to toggle morning / evening</p>
                    </div>
                    <div class="calendar">
                        <div class="calendar-nav">
                            <button onclick="prevAzkarMonth()">â—€</button>
                            <h3 id="azkarMonthTitle"></h3>
                            <button onclick="nextAzkarMonth()">â–¶</button>
                        </div>
                        <div class="calendar-grid" id="azkarCalendar"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: SURAH -->
            <div class="tab-content" id="tab-surah">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ“ Surah Memorization</h2>
                        <button class="btn btn-primary btn-sm" onclick="openSurahPicker()">+ Add Surah</button>
                    </div>
                    <p style="font-size:13px;color:var(--text-secondary);margin-bottom:12px">
                        Track your surah memorization progress ayah by ayah.
                    </p>
                    <input type="text" id="surahSearch" placeholder="ğŸ” Search surahs..." oninput="filterSurahs()"
                        style="width:100%;padding:10px;margin-bottom:16px;background:var(--bg-input);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-primary);font-family:'Inter',sans-serif">
                    <div id="surahList"></div>
                </div>
            </div>

            <!-- TAB: NAMAZ -->
            <div class="tab-content" id="tab-namaz">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ•Œ Daily Namaz</h2>
                        <p style="font-size:13px;color:var(--text-secondary)">Tap prayer â†’ mosque ğŸ•Œ â†’ home ğŸ  â†’ clear
                        </p>
                    </div>
                    <div class="calendar">
                        <div class="calendar-nav">
                            <button onclick="prevNamazMonth()">â—€</button>
                            <h3 id="namazMonthTitle"></h3>
                            <button onclick="nextNamazMonth()">â–¶</button>
                        </div>
                        <div id="namazGrid"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: STATS -->
            <div class="tab-content" id="tab-stats">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ“Š Family Charts</h2>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr;gap:24px">
                        <div
                            style="background:var(--bg-card);border:1px solid var(--border-color);border-radius:var(--radius-md);padding:16px;">
                            <h3 style="font-size:14px; margin-bottom: 12px; text-align:center;">Taraweeh (Rakaat per
                                day)</h3>
                            <canvas id="taraweehChart" height="200"></canvas>
                        </div>
                        <div
                            style="background:var(--bg-card);border:1px solid var(--border-color);border-radius:var(--radius-md);padding:16px;">
                            <h3 style="font-size:14px; margin-bottom: 12px; text-align:center;">Family Score Comparison
                            </h3>
                            <canvas id="scoreChart" height="200"></canvas>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ† Family Leaderboard</h2>
                    </div>
                    <div id="leaderboardTable" style="overflow-x:auto"></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ–ï¸ Badges</h2>
                    </div>
                    <div id="badgesContainer"></div>
                </div>
            </div>

            <!-- TAB: ADMIN -->
            <div class="tab-content" id="tab-admin">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ‘‘ User Management</h2>
                    </div>
                    <input type="text" class="admin-search" id="adminSearch" placeholder="ğŸ” Search by name or email..."
                        oninput="filterAdminUsers()">
                    <div id="adminUserList"></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>âœï¸ Edit User Data</h2>
                    </div>
                    <p style="font-size:13px;color:var(--text-secondary);margin-bottom:12px">Select a user to view and
                        edit their data (Taraweeh, Quran, Fasting, etc.).</p>
                    <div style="display:flex;gap:8px;align-items:center">
                        <select id="adminEditUserSelect"
                            style="flex:1;padding:10px;background:var(--bg-input);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-primary);font-family:'Inter',sans-serif">
                            <option value="">â€” Select user â€”</option>
                        </select>
                        <button class="btn btn-primary btn-sm" onclick="openAdminEditUser()">Edit</button>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ“¥ Export Data</h2>
                    </div>
                    <p style="font-size:13px;color:var(--text-secondary);margin-bottom:12px">Download all data
                        (Taraweeh, Quran, Fasting, Azkar, Surah, Namaz) as JSON.</p>
                    <button class="btn btn-secondary" onclick="exportCSV()">ğŸ“¥ Download CSV</button>
                </div>
            </div>

        </div><!-- main-content -->

        <!-- TARAWEEH MODAL -->
        <div class="modal-overlay hidden" id="taraweehModal">
            <div class="modal">
                <h3>ğŸ•Œ Log Taraweeh â€” <span id="taraweehModalDate"></span></h3>
                <p style="font-size:14px;color:var(--text-secondary);margin-bottom:16px">How many rakaat?</p>
                <div style="display:flex;align-items:center;gap:12px;margin-top:12px">
                    <input type="number" id="rakaatInput" min="1" max="20" value="8"
                        style="width:80px;padding:12px;font-size:20px;font-weight:700;text-align:center;background:var(--bg-input);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--gold);font-family:'Inter',sans-serif">
                    <span style="color:var(--text-secondary);font-size:14px">rakaat (1â€“20)</span>
                </div>
                <div style="display:flex;gap:8px;margin-top:8px">
                    <button class="btn btn-secondary btn-sm"
                        onclick="document.getElementById('rakaatInput').value=8">8</button>
                    <button class="btn btn-secondary btn-sm"
                        onclick="document.getElementById('rakaatInput').value=20">20</button>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeTaraweehModal()">Cancel</button>
                    <button class="btn btn-danger btn-sm" id="taraweehRemoveBtn" onclick="removeTaraweeh()"
                        style="display:none">Remove</button>
                    <button class="btn btn-primary" onclick="saveTaraweeh()">Save âœ“</button>
                </div>
            </div>
        </div>

        <!-- NAMAZ MODAL -->
        <div class="modal-overlay hidden" id="namazModal">
            <div class="modal">
                <h3>ğŸ•Œ Log Namaz â€” <span id="namazModalDate"></span></h3>
                <p style="font-size:14px;color:var(--text-secondary);margin-bottom:16px">Select location for each
                    prayer.</p>
                <div id="namazModalGrid" style="display:flex;flex-direction:column;gap:12px;margin-bottom:20px">
                    <!-- Populated by JS -->
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeNamazModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveNamazDay()">Save âœ“</button>
                </div>
            </div>
        </div>

        <!-- AZKAR MODAL -->
        <div class="modal-overlay hidden" id="azkarModal">
            <div class="modal">
                <h3>ğŸ“¿ Log Azkar â€” <span id="azkarModalDate"></span></h3>
                <p style="font-size:14px;color:var(--text-secondary);margin-bottom:16px">Which daily Dhikr have you
                    completed?</p>

                <div style="display:flex;flex-direction:column;gap:12px;margin-bottom:24px">
                    <label
                        style="display:flex;align-items:center;padding:16px;background:var(--bg-input);border:1px solid var(--border-color);border-radius:var(--radius-sm);cursor:pointer;gap:16px">
                        <input type="checkbox" id="azkarMorningCheck"
                            style="width:24px;height:24px;accent-color:var(--gold)">
                        <div style="flex:1">
                            <div style="font-weight:600;font-size:16px">â˜€ï¸ Morning Azkar</div>
                            <div style="font-size:12px;color:var(--text-secondary);margin-top:2px">After Fajr to Sunrise
                            </div>
                        </div>
                    </label>

                    <label
                        style="display:flex;align-items:center;padding:16px;background:var(--bg-input);border:1px solid var(--border-color);border-radius:var(--radius-sm);cursor:pointer;gap:16px">
                        <input type="checkbox" id="azkarEveningCheck"
                            style="width:24px;height:24px;accent-color:var(--gold)">
                        <div style="flex:1">
                            <div style="font-weight:600;font-size:16px">ğŸŒ™ Evening Azkar</div>
                            <div style="font-size:12px;color:var(--text-secondary);margin-top:2px">After Asr to Maghrib
                            </div>
                        </div>
                    </label>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeAzkarModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveAzkarDay()">Save âœ“</button>
                </div>
            </div>
        </div>

        <!-- PROFILE MODAL -->
        <div class="modal-overlay hidden" id="profileModal">
            <div class="modal">
                <h3>ğŸ‘¤ My Profile</h3>
                <div class="profile-info">
                    <span class="label">Username</span><span class="value" id="profileUsername"></span>
                    <span class="label">Email</span><span class="value" id="profileEmail"></span>
                    <span class="label">Role</span><span class="value" id="profileRole"></span>
                </div>
                <hr style="border-color:var(--border-color);margin:16px 0">
                <h3 style="font-size:15px">ğŸ”‘ Change Password</h3>
                <div class="form-group"><label>Current Password</label><input type="password" id="oldPassword"
                        placeholder="Enter current password"></div>
                <div class="form-group"><label>New Password</label><input type="password" id="newPassword"
                        placeholder="Min 4 characters"></div>
                <div class="form-group"><label>Confirm New Password</label><input type="password"
                        id="confirmNewPassword" placeholder="Re-enter new password"></div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeProfile()">Close</button>
                    <button class="btn btn-primary" onclick="changePasswordSubmit()">Update Password</button>
                </div>
            </div>
        </div>

        <!-- LOADING OVERLAY -->
        <div class="loading-overlay hidden" id="loadingOverlay">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>

    </div><!-- dashboardWrapper -->

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/app.js"></script>
</body>

</html>
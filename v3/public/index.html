<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Family Ramadan tracker â€” taraweeh, quran, fasting, azkar, surah memorization, namaz">
    <title>RamadanFlow</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ•Œ</text></svg>">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/responsive.css">
</head>

<body>

    <!-- ============================================================= -->
    <!-- LOGIN PAGE -->
    <!-- ============================================================= -->
    <div class="page-wrapper" id="loginWrapper">
        <div class="auth-container">
            <div class="auth-card">
                <div class="logo">
                    <span class="icon">ğŸ•Œ</span>
                    <h1>RamadanFlow</h1>
                    <p>Family Ramadan Progress</p>
                </div>
                <div id="loginAlert" class="alert"></div>
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Email or Username</label>
                        <input type="text" id="identifier" placeholder="Enter email or username" required
                            autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter password" required
                            autocomplete="current-password">
                    </div>
                    <input name="website" type="text" style="display:none" tabindex="-1" autocomplete="off">
                    <button type="submit" class="btn btn-primary" id="loginBtn">Sign In</button>
                </form>
                <div class="auth-link">
                    Don't have an account? <a href="#" onclick="goToPage('Register')">Register</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================================= -->
    <!-- REGISTER PAGE -->
    <!-- ============================================================= -->
    <div class="page-wrapper" id="registerWrapper" style="display:none">
        <div class="auth-container">
            <div class="auth-card">
                <div class="logo">
                    <span class="icon">ğŸ•Œ</span>
                    <h1>RamadanFlow</h1>
                    <p>Join your family's Ramadan journey</p>
                </div>
                <div id="registerAlert" class="alert"></div>
                <form id="registerForm" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="regUsername" placeholder="e.g. First_Name Middle_Name Last_Name" required
                            minlength="3" autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="regEmail" placeholder="your@email.com" required autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select id="regGender" required>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Age</label>
                        <input type="number" id="regAge" placeholder="Your age (e.g. 30)" required min="5" max="120">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="regPassword" placeholder="At least 4 characters" required
                            minlength="4" autocomplete="new-password">
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="regConfirmPassword" placeholder="Re-enter password" required
                            autocomplete="new-password">
                    </div>
                    <input name="website" type="text" style="display:none" tabindex="-1" autocomplete="off">
                    <button type="submit" class="btn btn-primary" id="registerBtn">Create Account</button>
                </form>
                <div class="auth-link">
                    Already have an account? <a href="#" onclick="goToPage('Login')">Sign In</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================================= -->
    <!-- DASHBOARD -->
    <!-- ============================================================= -->
    <div class="page-wrapper" id="dashboardWrapper" style="display:none">

        <!-- SIDEBAR (Desktop only, hidden by CSS on mobile) -->
        <aside class="sidebar" id="desktopSidebar">
            <div class="sidebar-logo">
                <span class="icon">ğŸ•Œ</span>
                <h2>RamadanFlow</h2>
                <p>Family Tracker</p>
            </div>
            <nav class="sidebar-nav">
                <button class="sidebar-nav-item active" data-tab="taraweeh" onclick="switchTab('taraweeh')">
                    <span class="nav-icon">ğŸ•Œ</span> Taraweeh
                </button>
                <button class="sidebar-nav-item" data-tab="quran" onclick="switchTab('quran')">
                    <span class="nav-icon">ğŸ“–</span> Quran
                </button>
                <button class="sidebar-nav-item" data-tab="fasting" onclick="switchTab('fasting')">
                    <span class="nav-icon">ğŸ½ï¸</span> Fasting
                </button>
                <button class="sidebar-nav-item" data-tab="azkar" onclick="switchTab('azkar')">
                    <span class="nav-icon">ğŸ“¿</span> Azkar
                </button>
                <button class="sidebar-nav-item" data-tab="surah" onclick="switchTab('surah')">
                    <span class="nav-icon">ğŸ“</span> Surah
                </button>
                <button class="sidebar-nav-item" data-tab="namaz" onclick="switchTab('namaz')">
                    <span class="nav-icon">ğŸ•Œ</span> Namaz
                </button>
                <button class="sidebar-nav-item" data-tab="stats" onclick="switchTab('stats')">
                    <span class="nav-icon">ğŸ“Š</span> Stats
                </button>
                <button class="sidebar-nav-item" data-tab="admin" id="sidebarAdminBtn" style="display:none"
                    onclick="switchTab('admin')">
                    <span class="nav-icon">ğŸ‘‘</span> Admin
                </button>
            </nav>
            <div class="sidebar-user">
                <div class="sidebar-user-info" onclick="openProfile()">
                    <div>
                        <div class="name" id="sidebarName">User</div>
                        <div class="role-tag" id="sidebarRole">user</div>
                    </div>
                </div>
                <button class="sidebar-logout" onclick="logout()">ğŸšª Logout</button>
            </div>
        </aside>

        <!-- HEADER -->
        <header class="header">
            <div class="header-left">
                <span class="icon">ğŸ•Œ</span>
                <h1>RamadanFlow</h1>
            </div>
            <div class="header-right">
                <select id="yearSelect" onchange="changeYear()">
                    <script>
                        var cy = new Date().getFullYear();
                        for (var y = cy + 1; y >= cy - 5; y--) {
                            document.write('<option value="' + y + '"' + (y === cy ? ' selected' : '') + '>' + y + '</option>');
                        }
                    </script>
                </select>
                <div class="user-badge" onclick="openProfile()">
                    <span>ğŸ‘¤ <span id="displayName"></span></span>
                    <span class="role" id="displayRole"></span>
                </div>
                <button class="btn btn-secondary btn-sm" onclick="logout()">Logout</button>
            </div>
        </header>

        <!-- ANNOUNCEMENT BANNER -->
        <div id="announcementBanner"
            style="display:none;background:linear-gradient(135deg,#c9a84c,#e0c068);color:#0a1628;padding:10px 16px;font-size:13px;font-weight:600;align-items:center;justify-content:space-between;gap:8px">
            <span>ğŸ“¢ <span id="announcementText"></span></span>
            <button onclick="dismissAnnouncement()"
                style="background:none;border:none;color:#0a1628;font-size:18px;cursor:pointer;padding:0 4px">Ã—</button>
        </div>

        <!-- IMPERSONATE BANNER -->
        <div id="impersonateBanner"
            style="display:none;background:linear-gradient(135deg,#e74c3c,#c0392b);color:#fff;padding:10px 16px;font-size:13px;font-weight:600;align-items:center;justify-content:space-between;gap:8px">
            <span>ğŸ‘¤ Admin Preview: Viewing as <span id="impersonateName"></span> (read-only)</span>
            <button onclick="exitImpersonate()" class="btn btn-sm"
                style="background:rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.3);color:#fff;font-size:12px;padding:4px 12px">Exit
                Preview</button>
        </div>

        <!-- FROZEN BANNER -->
        <div id="frozenBanner"
            style="display:none;background:linear-gradient(135deg,#3498db,#2980b9);color:#fff;padding:10px 16px;font-size:13px;font-weight:600;text-align:center">
            ğŸ”’ Your account is frozen. No new entries can be saved.
        </div>

        <!-- QUICK STATS -->
        <div class="main-content">
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-value" id="statTaraweeh">-</div>
                    <div class="stat-label">ğŸ•Œ Taraweeh</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statStreak">-</div>
                    <div class="stat-label">ğŸ”¥ Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statParas">-</div>
                    <div class="stat-label">ğŸ“– Paras</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statKhatams">-</div>
                    <div class="stat-label">âœ… Khatams</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statFasting">-</div>
                    <div class="stat-label">ğŸ½ï¸ Fasts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statAzkar">-</div>
                    <div class="stat-label">ğŸ“¿ Azkar</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statNamaz">-</div>
                    <div class="stat-label">ğŸ•Œ Namaz</div>
                </div>
            </div>

            <!-- MULTI-REGION TRACKER -->
            <div id="multiRegionTracker" class="multi-region-tracker"
                style="display:none; text-align: center; margin-bottom: 20px;">
                <h4 id="multiRegionTitle" style="color: var(--gold); margin-bottom: 8px;">â³ Expected Ramadan Duration
                </h4>
                <div class="region-dates" style="display: flex; justify-content: center; gap: 8px; flex-wrap: wrap;">
                    <span class="badge region-badge ksa-badge">ğŸ‡¸ğŸ‡¦ KSA: <strong id="ksaStart">...</strong></span>
                    <span class="badge region-badge pak-badge">ğŸ‡µğŸ‡° PAK: <strong id="pakStart">...</strong></span>
                    <span class="badge region-badge az-badge">ğŸ‡¦ğŸ‡¿ AZ: <strong id="azStart">...</strong></span>
                </div>
            </div>

            <!-- SKELETON -->
            <div id="skeletonArea" style="display:none"></div>

            <!-- ADMIN EDIT BANNER -->
            <div id="adminEditBanner"
                style="display:none;background:rgba(201,168,76,0.15);border:1px solid var(--gold);border-radius:var(--radius-sm);padding:12px 16px;margin-bottom:16px;align-items:center;justify-content:space-between">
                <span>ğŸ‘‘ Editing as: <strong id="adminEditName"></strong></span>
                <button class="btn btn-secondary btn-sm" onclick="exitAdminEdit()">â† Back to My Data</button>
            </div>

            <!-- TABS -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="taraweeh" onclick="switchTab('taraweeh')">ğŸ•Œ Taraweeh</button>
                <button class="tab-btn" data-tab="quran" onclick="switchTab('quran')">ğŸ“– Quran</button>
                <button class="tab-btn" data-tab="fasting" onclick="switchTab('fasting')">ğŸ½ï¸ Fasting</button>
                <button class="tab-btn" data-tab="azkar" onclick="switchTab('azkar')">ğŸ“¿ Azkar</button>
                <button class="tab-btn" data-tab="surah" onclick="switchTab('surah')">ğŸ“ Surah</button>
                <button class="tab-btn" data-tab="namaz" onclick="switchTab('namaz')">ğŸ•Œ Namaz</button>
                <button class="tab-btn" data-tab="stats" onclick="switchTab('stats')">ğŸ“Š Stats</button>
                <button class="tab-btn" data-tab="admin" id="adminTabBtn" style="display:none"
                    onclick="switchTab('admin')">ğŸ‘‘ Admin</button>
            </div>

            <!-- TAB: TARAWEEH -->
            <div class="tab-content active" id="tab-taraweeh">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ•Œ Taraweeh Calendar</h2>
                        <p style="font-size:13px;color:var(--text-secondary)">Click a date to log prayer</p>
                    </div>
                    <div class="calendar">
                        <div class="calendar-nav">
                            <button onclick="prevMonth()">â—€</button>
                            <h3 id="taraweehMonthTitle"></h3>
                            <button onclick="nextMonth()">â–¶</button>
                        </div>
                        <div class="calendar-grid" id="taraweehCalendar"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: QURAN -->
            <div class="tab-content" id="tab-quran">
                <div class="card">
                    <div class="card-header" style="align-items:center;">
                        <h2>ğŸ“– Quran Progress</h2>
                        <div style="display:flex;gap:8px">
                            <button class="btn btn-primary btn-sm" onclick="startNewKhatam('Arabic')">+ Arabic</button>
                            <button class="btn btn-secondary btn-sm" onclick="startNewKhatam('Translation')">+
                                Translation</button>
                        </div>
                    </div>
                    <p style="font-size:13px;color:var(--text-secondary);margin-bottom:16px">
                        Click para numbers to toggle. Start unlimited khatams â€” Arabic or Translation.
                    </p>
                    <div id="khatamList"></div>
                </div>
            </div>

            <!-- TAB: FASTING -->
            <div class="tab-content" id="tab-fasting">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ½ï¸ Fasting Tracker</h2>
                        <p style="font-size:13px;color:var(--text-secondary)">Click a date to toggle</p>
                    </div>
                    <div class="calendar">
                        <div class="calendar-nav">
                            <button onclick="prevFastingMonth()">â—€</button>
                            <h3 id="fastingMonthTitle"></h3>
                            <button onclick="nextFastingMonth()">â–¶</button>
                        </div>
                        <div class="calendar-grid" id="fastingCalendar"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: AZKAR -->
            <div class="tab-content" id="tab-azkar">
                <div class="card"
                    style="margin-bottom:16px; background: rgba(201,168,76,0.1); border-left: 4px solid var(--gold);">
                    <div style="padding: 16px;">
                        <h2 style="font-size: 16px; margin-bottom: 8px;">âœ¨ Daily Authentic Dhikr</h2>
                        <div id="dailyDhikrText" style="margin-bottom: 8px;">
                            <p style="font-size: 14px; font-style: italic; color: var(--text-primary);">Loading daily
                                dhikr...</p>
                        </div>
                        <p id="dailyDhikrRef" style="font-size: 12px; color: var(--text-secondary); text-align: right;">
                            -</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ“¿ Daily Azkar</h2>
                        <p style="font-size:13px;color:var(--text-secondary)">Tap to toggle morning / evening</p>
                    </div>
                    <div class="calendar">
                        <div class="calendar-nav">
                            <button onclick="prevAzkarMonth()">â—€</button>
                            <h3 id="azkarMonthTitle"></h3>
                            <button onclick="nextAzkarMonth()">â–¶</button>
                        </div>
                        <div class="calendar-grid" id="azkarCalendar"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: SURAH -->
            <div class="tab-content" id="tab-surah">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ“ Surah Memorization</h2>
                        <button class="btn btn-primary btn-sm" onclick="openSurahPicker()">+ Add Surah</button>
                    </div>
                    <p style="font-size:13px;color:var(--text-secondary);margin-bottom:12px">
                        Track your surah memorization progress ayah by ayah.
                    </p>
                    <input type="text" id="surahSearch" placeholder="ğŸ” Search surahs..." oninput="filterSurahs()"
                        style="width:100%;padding:10px;margin-bottom:16px;background:var(--bg-input);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-primary);font-family:'Inter',sans-serif">
                    <div id="surahList"></div>
                </div>
            </div>

            <!-- TAB: NAMAZ -->
            <div class="tab-content" id="tab-namaz">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ•Œ Daily Namaz</h2>
                        <p style="font-size:13px;color:var(--text-secondary)">Tap prayer â†’ mosque ğŸ•Œ â†’ home ğŸ  â†’ clear
                        </p>
                    </div>
                    <div class="calendar">
                        <div class="calendar-nav">
                            <button onclick="prevNamazMonth()">â—€</button>
                            <h3 id="namazMonthTitle"></h3>
                            <button onclick="nextNamazMonth()">â–¶</button>
                        </div>
                        <div id="namazGrid"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: STATS -->
            <div class="tab-content" id="tab-stats">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ“Š Family Charts</h2>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr;gap:24px">
                        <div
                            style="background:var(--bg-card);border:1px solid var(--border-color);border-radius:var(--radius-md);padding:16px;">
                            <h3 style="font-size:14px; margin-bottom: 12px; text-align:center;">Taraweeh (Rakaat per
                                day)</h3>
                            <canvas id="taraweehChart" height="200"></canvas>
                        </div>
                        <div
                            style="background:var(--bg-card);border:1px solid var(--border-color);border-radius:var(--radius-md);padding:16px;">
                            <h3 style="font-size:14px; margin-bottom: 12px; text-align:center;">Family Score Comparison
                            </h3>
                            <canvas id="scoreChart" height="200"></canvas>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ† Family Leaderboard</h2>
                    </div>
                    <div id="leaderboardTable" style="overflow-x:auto"></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ–ï¸ Badges</h2>
                    </div>
                    <div id="badgesContainer"></div>
                </div>
            </div>

            <!-- TAB: ADMIN -->
            <div class="tab-content" id="tab-admin">

                <!-- OVERVIEW CARD (always visible) -->
                <div class="admin-overview" id="adminOverview">
                    <div class="admin-overview-card">
                        <div class="ov-value" id="ovUsers">â€”</div>
                        <div class="ov-label">ğŸ‘¥ Users</div>
                    </div>
                    <div class="admin-overview-card">
                        <div class="ov-value" id="ovToday">â€”</div>
                        <div class="ov-label">ğŸ“ Today</div>
                    </div>
                    <div class="admin-overview-card">
                        <div class="ov-value" id="ovActive">â€”</div>
                        <div class="ov-label">ğŸ”¥ Most Active</div>
                    </div>
                    <div class="admin-overview-card" id="ovAlertCard">
                        <div class="ov-value" id="ovAlerts">0</div>
                        <div class="ov-label">ğŸš¨ Alerts 24h</div>
                    </div>
                    <div class="admin-overview-card">
                        <div class="ov-value" id="ovUptime">â€”</div>
                        <div class="ov-label">â±ï¸ Uptime</div>
                    </div>
                    <div class="admin-overview-card">
                        <div class="ov-value" id="ovGit" style="font-size:14px">â€”</div>
                        <div class="ov-label">ğŸ”€ Last Commit</div>
                    </div>
                </div>

                <!-- SECTION: Users -->
                <div class="admin-section" id="adminSec-users">
                    <div class="admin-section-header" onclick="toggleAdminSection('users')">
                        <h3>ğŸ‘¥ User Management</h3>
                        <span class="admin-section-badge" id="adminBadge-users">0</span>
                        <span class="admin-section-chevron">â–¼</span>
                    </div>
                    <div class="admin-section-body">
                        <input type="text" class="admin-user-search" id="adminSearch"
                            placeholder="ğŸ” Search by name or email..." oninput="filterAdminUsers()">
                        <div class="admin-user-grid" id="adminUserList"></div>
                    </div>
                </div>

                <!-- SECTION: Ramadan Settings -->
                <div class="admin-section collapsed" id="adminSec-ramadan">
                    <div class="admin-section-header" onclick="toggleAdminSection('ramadan')">
                        <h3>ğŸ“… Ramadan Settings</h3>
                        <span class="admin-section-badge">3 regions</span>
                        <span class="admin-section-chevron">â–¼</span>
                    </div>
                    <div class="admin-section-body">
                        <p style="font-size:13px;color:var(--text-secondary);margin-bottom:12px">Region selector + date
                            overrides. Admin dates take priority over hardcoded overrides and the Aladhan API.</p>
                        <div style="display:flex;gap:8px;align-items:center;margin-bottom:16px">
                            <select id="adminRegionSelect"
                                style="flex:1;padding:10px;background:var(--bg-input);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-primary);font-family:'Inter',sans-serif">
                                <option value="Saudi Arabia,Makkah">ğŸ‡¸ğŸ‡¦ Saudi Arabia (Makkah)</option>
                                <option value="Pakistan,Islamabad">ğŸ‡µğŸ‡° Pakistan (Islamabad)</option>
                                <option value="Azerbaijan,Baku">ğŸ‡¦ğŸ‡¿ Azerbaijan (Baku)</option>
                            </select>
                            <button class="btn btn-primary btn-sm" onclick="saveAdminRegion()">Save Region</button>
                        </div>
                        <div id="adminRamadanDates" style="display:flex;flex-direction:column;gap:4px"></div>
                    </div>
                </div>

                <!-- SECTION: Security Analytics -->
                <div class="admin-section collapsed" id="adminSec-security">
                    <div class="admin-section-header" onclick="toggleAdminSection('security')">
                        <h3>ğŸ›¡ï¸ Security Analytics</h3>
                        <span class="admin-section-badge" id="adminBadge-security">â€”</span>
                        <span class="admin-section-chevron">â–¼</span>
                    </div>
                    <div class="admin-section-body">
                        <!-- Anomaly Feed -->
                        <h4 style="color:var(--gold);margin:0 0 8px">âš ï¸ Anomaly Feed <span id="anomalyNewPill"
                                class="new-anomaly-pill" style="display:none" onclick="loadAnomalies()"></span></h4>
                        <div class="admin-filter-bar">
                            <select id="anomalyFilterSeverity" onchange="applyAnomalyFilters()">
                                <option value="">All Severity</option>
                                <option value="HIGH">HIGH</option>
                                <option value="MEDIUM">MEDIUM</option>
                                <option value="LOW">LOW</option>
                            </select>
                            <select id="anomalyFilterType" onchange="applyAnomalyFilters()">
                                <option value="">All Types</option>
                            </select>
                            <input type="text" id="anomalyFilterUser" placeholder="Username..."
                                oninput="applyAnomalyFilters()">
                            <label class="admin-toggle"><input type="checkbox" id="anomalySuppressToggle"
                                    onchange="loadAnomalies()"> Suppress false positives</label>
                        </div>
                        <div class="table-scroll-wrap">
                            <div id="anomalyFeed">Loading...</div>
                        </div>
                        <div style="display:flex;gap:8px;margin-top:10px">
                            <button class="btn btn-secondary btn-sm" onclick="exportAnomaliesCSV()">ğŸ“¥ Export
                                CSV</button>
                            <button class="btn btn-secondary btn-sm" style="color:var(--red)"
                                onclick="clearAllAnomalies()">ğŸ—‘ Clear All</button>
                        </div>

                        <hr style="border-color:var(--border-color);margin:20px 0">

                        <!-- Honeypot -->
                        <h4 style="color:var(--red);margin:0 0 8px">ğŸ¯ Honeypot Hits</h4>
                        <div class="table-scroll-wrap">
                            <div id="honeypotLog">Loading...</div>
                        </div>

                        <hr style="border-color:var(--border-color);margin:20px 0">

                        <!-- Fingerprints -->
                        <h4 style="color:var(--green, #2ecc71);margin:0 0 8px">ğŸ”‘ Fingerprint Consistency</h4>
                        <div class="table-scroll-wrap">
                            <div id="fingerprintScores">Loading...</div>
                        </div>

                        <hr style="border-color:var(--border-color);margin:20px 0">

                        <!-- Typing -->
                        <h4 style="color:var(--blue, #3498db);margin:0 0 8px">âŒ¨ï¸ Typing Baseline</h4>
                        <div class="table-scroll-wrap">
                            <div id="typingBaseline">Loading...</div>
                        </div>

                        <hr style="border-color:var(--border-color);margin:20px 0">

                        <!-- Live Request Log -->
                        <h4 style="color:var(--text-primary);margin:0 0 8px">ğŸ“¡ Live Request Log <span
                                style="font-size:11px;color:var(--text-muted)">(auto-refreshes 10s)</span></h4>
                        <div class="table-scroll-wrap">
                            <div id="liveRequestLog">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: Tools -->
                <div class="admin-section collapsed" id="adminSec-tools">
                    <div class="admin-section-header" onclick="toggleAdminSection('tools')">
                        <h3>ğŸ”§ Tools</h3>
                        <span class="admin-section-chevron">â–¼</span>
                    </div>
                    <div class="admin-section-body">
                        <div class="admin-tools-grid">
                            <div class="admin-tool-card">
                                <h4>ğŸ“¢ Announcement</h4>
                                <p style="font-size:12px;color:var(--text-secondary);margin-bottom:8px"
                                    id="currentAnnouncementPreview">No active announcement.</p>
                                <textarea id="adminAnnouncementInput" rows="2" placeholder="Type announcement..."
                                    style="width:100%;padding:8px;background:var(--bg-input);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-primary);font-family:'Inter',sans-serif;resize:vertical;margin-bottom:8px"></textarea>
                                <div style="display:flex;gap:8px">
                                    <button class="btn btn-primary btn-sm" onclick="setAnnouncement()">Set</button>
                                    <button class="btn btn-secondary btn-sm"
                                        onclick="clearAnnouncement()">Clear</button>
                                </div>
                            </div>
                            <div class="admin-tool-card">
                                <h4>ğŸ“¥ Export Data</h4>
                                <p style="font-size:12px;color:var(--text-secondary);margin-bottom:8px">Download all
                                    user tracker data.</p>
                                <div style="display:flex;flex-direction:column;gap:6px">
                                    <button class="btn btn-secondary btn-sm" onclick="exportJSON()">ğŸ“¥ Download
                                        JSON</button>
                                    <button class="btn btn-secondary btn-sm" onclick="exportCSV()">ğŸ“¥ Download
                                        CSV</button>
                                </div>
                            </div>
                            <div class="admin-tool-card">
                                <h4>ğŸ—„ï¸ Database Stats</h4>
                                <div id="dbStatsContainer" style="font-size:12px;color:var(--text-secondary)">Loading...
                                </div>
                                <button class="btn btn-secondary btn-sm" style="margin-top:8px"
                                    onclick="runWALCheckpoint()">ğŸ”„ WAL Checkpoint</button>
                                <div id="checkpointResult" class="action-status"></div>
                            </div>
                            <div class="admin-tool-card">
                                <h4>ğŸ“‹ Audit Log</h4>
                                <div class="table-scroll-wrap" style="max-height:200px;overflow-y:auto">
                                    <div id="auditLogContainer">Loading...</div>
                                </div>
                            </div>
                        </div><!-- admin-section tools -->

                    </div><!-- tab-admin -->

                </div><!-- main-content -->

                <!-- Taraweeh/Namaz/Azkar modals removed â€” now rendered dynamically by openSmartPopup() -->

                <!-- PROFILE MODAL -->
                <div class="modal-overlay hidden" id="profileModal">
                    <div class="modal">
                        <h3>ğŸ‘¤ My Profile</h3>
                        <div class="profile-info">
                            <span class="label">Username</span><span class="value" id="profileUsername"></span>
                            <span class="label">Email</span><span class="value" id="profileEmail"></span>
                            <span class="label">Role</span><span class="value" id="profileRole"></span>
                        </div>
                        <hr style="border-color:var(--border-color);margin:16px 0">
                        <h3 style="font-size:15px">ğŸ”‘ Change Password</h3>
                        <div class="form-group"><label>Current Password</label><input type="password" id="oldPassword"
                                placeholder="Enter current password"></div>
                        <div class="form-group"><label>New Password</label><input type="password" id="newPassword"
                                placeholder="Min 4 characters"></div>
                        <div class="form-group"><label>Confirm New Password</label><input type="password"
                                id="confirmNewPassword" placeholder="Re-enter new password"></div>
                        <div class="modal-actions">
                            <button class="btn btn-secondary" onclick="closeProfile()">Close</button>
                            <button class="btn btn-primary" onclick="changePasswordSubmit()">Update Password</button>
                        </div>
                    </div>
                </div>

                <!-- DATA EDITOR MODAL -->
                <div class="modal-overlay hidden" id="dataEditorModal">
                    <div class="modal" style="max-height:85vh;overflow-y:auto">
                        <h3 id="dataEditorTitle">ğŸ“ Edit Data</h3>
                        <p style="font-size:13px;color:var(--text-secondary);margin-bottom:12px">Modify values and click
                            Save.
                            All changes are audit-logged.</p>
                        <div id="dataEditorContent" style="max-height:50vh;overflow-y:auto;padding-right:8px">
                        </div>
                        <div class="modal-actions" style="margin-top:16px">
                            <button class="btn btn-secondary" onclick="closeDataEditor()">Cancel</button>
                            <button class="btn btn-primary" onclick="saveDataEditor()">Save Changes âœ“</button>
                        </div>
                    </div>
                </div>

                <!-- LOADING OVERLAY -->
                <div class="loading-overlay hidden" id="loadingOverlay">
                    <div class="spinner"></div>
                    <p>Loading...</p>
                </div>

            </div><!-- dashboardWrapper -->

            <!-- BOTTOM NAV (Mobile only, hidden by CSS on desktop) -->
            <nav class="bottom-nav" id="bottomNav">
                <button class="bottom-nav-item active" data-tab="taraweeh" onclick="switchTab('taraweeh')">
                    <span class="nav-icon">ğŸ•Œ</span>
                    <span>Taraweeh</span>
                </button>
                <button class="bottom-nav-item" data-tab="quran" onclick="switchTab('quran')">
                    <span class="nav-icon">ğŸ“–</span>
                    <span>Quran</span>
                </button>
                <button class="bottom-nav-item" data-tab="fasting" onclick="switchTab('fasting')">
                    <span class="nav-icon">ğŸ½ï¸</span>
                    <span>Fasting</span>
                </button>
                <button class="bottom-nav-item" data-tab="azkar" onclick="switchTab('azkar')">
                    <span class="nav-icon">ğŸ“¿</span>
                    <span>Azkar</span>
                </button>
                <button class="bottom-nav-item" data-tab="surah" onclick="switchTab('surah')">
                    <span class="nav-icon">ğŸ“</span>
                    <span>Surah</span>
                </button>
                <button class="bottom-nav-item" data-tab="namaz" onclick="switchTab('namaz')">
                    <span class="nav-icon">ğŸ•Œ</span>
                    <span>Namaz</span>
                </button>
                <button class="bottom-nav-item" data-tab="stats" onclick="switchTab('stats')">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span>Stats</span>
                </button>
                <button class="bottom-nav-item" data-tab="admin" id="bottomNavAdminBtn" style="display:none"
                    onclick="switchTab('admin')">
                    <span class="nav-icon">ğŸ‘‘</span>
                    <span>Admin</span>
                </button>
            </nav>

            <div class="version-tag">v3.RC1</div>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script src="/app.js"></script>
            <script src="/admin.js"></script>
            <script src="/analytics-client.js"></script>
</body>

</html>
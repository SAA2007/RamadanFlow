<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RamadanFlow</title>
    <link rel="stylesheet" href="/style.css">
</head>

<body>

    <!-- ============================================================= -->
    <!-- LOGIN PAGE -->
    <!-- ============================================================= -->
    <div class="page-wrapper" id="loginWrapper">
        <div class="auth-container">
            <div class="auth-card">
                <div class="logo">
                    <span class="icon">ğŸ•Œ</span>
                    <h1>RamadanFlow</h1>
                    <p>Family Ramadan Progress</p>
                </div>
                <div id="loginAlert" class="alert"></div>
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Email or Username</label>
                        <input type="text" id="identifier" placeholder="Enter email or username" required
                            autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter password" required
                            autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn btn-primary" id="loginBtn">Sign In</button>
                </form>
                <div class="auth-link">
                    Don't have an account? <a href="#" onclick="goToPage('Register')">Register</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================================= -->
    <!-- REGISTER PAGE -->
    <!-- ============================================================= -->
    <div class="page-wrapper" id="registerWrapper" style="display:none">
        <div class="auth-container">
            <div class="auth-card">
                <div class="logo">
                    <span class="icon">ğŸ•Œ</span>
                    <h1>RamadanFlow</h1>
                    <p>Join your family's Ramadan journey</p>
                </div>
                <div id="registerAlert" class="alert"></div>
                <form id="registerForm" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="regUsername" placeholder="e.g. ahmed_k" required minlength="3"
                            autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="regEmail" placeholder="your@email.com" required autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="regPassword" placeholder="At least 4 characters" required
                            minlength="4" autocomplete="new-password">
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="regConfirmPassword" placeholder="Re-enter password" required
                            autocomplete="new-password">
                    </div>
                    <button type="submit" class="btn btn-primary" id="registerBtn">Create Account</button>
                </form>
                <div class="auth-link">
                    Already have an account? <a href="#" onclick="goToPage('Login')">Sign In</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================================= -->
    <!-- DASHBOARD -->
    <!-- ============================================================= -->
    <div class="page-wrapper" id="dashboardWrapper" style="display:none">

        <!-- HEADER -->
        <header class="header">
            <div class="header-left">
                <span class="icon">ğŸ•Œ</span>
                <h1>RamadanFlow</h1>
            </div>
            <div class="header-right">
                <select id="yearSelect" onchange="changeYear()">
                    <script>
                        var cy = new Date().getFullYear();
                        for (var y = cy + 1; y >= cy - 5; y--) {
                            document.write('<option value="' + y + '"' + (y === cy ? ' selected' : '') + '>' + y + '</option>');
                        }
                    </script>
                </select>
                <div class="user-badge" onclick="openProfile()">
                    <span>ğŸ‘¤ <span id="displayName"></span></span>
                    <span class="role" id="displayRole"></span>
                </div>
                <button class="btn btn-secondary btn-sm" onclick="logout()">Logout</button>
            </div>
        </header>

        <!-- QUICK STATS -->
        <div class="main-content">
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-value" id="statTaraweeh">-</div>
                    <div class="stat-label">ğŸ•Œ Taraweeh</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statStreak">-</div>
                    <div class="stat-label">ğŸ”¥ Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statParas">-</div>
                    <div class="stat-label">ğŸ“– Paras</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statKhatams">-</div>
                    <div class="stat-label">âœ… Khatams</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statFasting">-</div>
                    <div class="stat-label">ğŸ½ï¸ Fasts</div>
                </div>
            </div>

            <!-- SKELETON -->
            <div id="skeletonArea" style="display:none"></div>

            <!-- ADMIN EDIT BANNER -->
            <div id="adminEditBanner"
                style="display:none;background:rgba(201,168,76,0.15);border:1px solid var(--gold);border-radius:var(--radius-sm);padding:12px 16px;margin-bottom:16px;align-items:center;justify-content:space-between">
                <span>ğŸ‘‘ Editing as: <strong id="adminEditName"></strong></span>
                <button class="btn btn-secondary btn-sm" onclick="exitAdminEdit()">â† Back to My Data</button>
            </div>

            <!-- TABS -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="taraweeh" onclick="switchTab('taraweeh')">ğŸ•Œ Taraweeh</button>
                <button class="tab-btn" data-tab="quran" onclick="switchTab('quran')">ğŸ“– Quran</button>
                <button class="tab-btn" data-tab="fasting" onclick="switchTab('fasting')">ğŸ½ï¸ Fasting</button>
                <button class="tab-btn" data-tab="stats" onclick="switchTab('stats')">ğŸ“Š Stats</button>
                <button class="tab-btn" data-tab="admin" id="adminTabBtn" style="display:none"
                    onclick="switchTab('admin')">ğŸ‘‘ Admin</button>
            </div>

            <!-- TAB: TARAWEEH -->
            <div class="tab-content active" id="tab-taraweeh">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ•Œ Taraweeh Calendar</h2>
                        <p style="font-size:13px;color:var(--text-secondary)">Click a date to log prayer</p>
                    </div>
                    <div class="calendar">
                        <div class="calendar-nav">
                            <button onclick="prevMonth()">â—€</button>
                            <h3 id="taraweehMonthTitle"></h3>
                            <button onclick="nextMonth()">â–¶</button>
                        </div>
                        <div class="calendar-grid" id="taraweehCalendar"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: QURAN -->
            <div class="tab-content" id="tab-quran">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ“– Quran Progress</h2>
                        <div style="display:flex;gap:8px">
                            <button class="btn btn-primary btn-sm" onclick="startNewKhatam('Arabic')">+ Arabic</button>
                            <button class="btn btn-secondary btn-sm" onclick="startNewKhatam('Translation')">+
                                Translation</button>
                        </div>
                    </div>
                    <p style="font-size:13px;color:var(--text-secondary);margin-bottom:16px">
                        Click para numbers to toggle. Start unlimited khatams â€” Arabic or Translation.
                    </p>
                    <div id="khatamList"></div>
                </div>
            </div>

            <!-- TAB: FASTING -->
            <div class="tab-content" id="tab-fasting">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ½ï¸ Fasting Tracker</h2>
                        <p style="font-size:13px;color:var(--text-secondary)">Click a date to toggle</p>
                    </div>
                    <div class="calendar">
                        <div class="calendar-nav">
                            <button onclick="prevFastingMonth()">â—€</button>
                            <h3 id="fastingMonthTitle"></h3>
                            <button onclick="nextFastingMonth()">â–¶</button>
                        </div>
                        <div class="calendar-grid" id="fastingCalendar"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: STATS -->
            <div class="tab-content" id="tab-stats">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ“Š Family Charts</h2>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr;gap:24px">
                        <div id="taraweehChart"></div>
                        <div id="quranChart"></div>
                        <div id="fastingChart"></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ† Family Leaderboard</h2>
                    </div>
                    <div id="leaderboardTable" style="overflow-x:auto"></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ–ï¸ Badges</h2>
                    </div>
                    <div id="badgesContainer"></div>
                </div>
            </div>

            <!-- TAB: ADMIN -->
            <div class="tab-content" id="tab-admin">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ‘‘ User Management</h2>
                    </div>
                    <input type="text" class="admin-search" id="adminSearch" placeholder="ğŸ” Search by name or email..."
                        oninput="filterAdminUsers()">
                    <div id="adminUserList"></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>âœï¸ Edit User Data</h2>
                    </div>
                    <p style="font-size:13px;color:var(--text-secondary);margin-bottom:12px">Select a user to view and
                        edit their Taraweeh calendar entries.</p>
                    <div style="display:flex;gap:8px;align-items:center">
                        <select id="adminEditUserSelect"
                            style="flex:1;padding:10px;background:var(--bg-input);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-primary);font-family:'Inter',sans-serif">
                            <option value="">â€” Select user â€”</option>
                        </select>
                        <button class="btn btn-primary btn-sm" onclick="openAdminEditUser()">Edit</button>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ“¥ Export Data</h2>
                    </div>
                    <p style="font-size:13px;color:var(--text-secondary);margin-bottom:12px">Download all Taraweeh,
                        Quran, and Fasting data as CSV.</p>
                    <button class="btn btn-secondary" onclick="exportCSV()">ğŸ“¥ Download CSV</button>
                </div>
            </div>

        </div><!-- main-content -->

        <!-- TARAWEEH MODAL -->
        <div class="modal-overlay hidden" id="taraweehModal">
            <div class="modal">
                <h3>ğŸ•Œ Log Taraweeh â€” <span id="taraweehModalDate"></span></h3>
                <p style="font-size:14px;color:var(--text-secondary);margin-bottom:16px">How many rakaat?</p>
                <div class="rakaat-options">
                    <div class="rakaat-option selected" data-rakaat="8" onclick="selectRakaat(this)">
                        <div class="number">8</div>
                        <div class="label">Rakaat</div>
                    </div>
                    <div class="rakaat-option" data-rakaat="20" onclick="selectRakaat(this)">
                        <div class="number">20</div>
                        <div class="label">Rakaat</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeTaraweehModal()">Cancel</button>
                    <button class="btn btn-danger btn-sm" id="taraweehRemoveBtn" onclick="removeTaraweeh()"
                        style="display:none">Remove</button>
                    <button class="btn btn-primary" onclick="saveTaraweeh()">Save âœ“</button>
                </div>
            </div>
        </div>

        <!-- PROFILE MODAL -->
        <div class="modal-overlay hidden" id="profileModal">
            <div class="modal">
                <h3>ğŸ‘¤ My Profile</h3>
                <div class="profile-info">
                    <span class="label">Username</span><span class="value" id="profileUsername"></span>
                    <span class="label">Email</span><span class="value" id="profileEmail"></span>
                    <span class="label">Role</span><span class="value" id="profileRole"></span>
                </div>
                <hr style="border-color:var(--border-color);margin:16px 0">
                <h3 style="font-size:15px">ğŸ”‘ Change Password</h3>
                <div class="form-group"><label>Current Password</label><input type="password" id="oldPassword"
                        placeholder="Enter current password"></div>
                <div class="form-group"><label>New Password</label><input type="password" id="newPassword"
                        placeholder="Min 4 characters"></div>
                <div class="form-group"><label>Confirm New Password</label><input type="password"
                        id="confirmNewPassword" placeholder="Re-enter new password"></div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeProfile()">Close</button>
                    <button class="btn btn-primary" onclick="changePasswordSubmit()">Update Password</button>
                </div>
            </div>
        </div>

        <!-- LOADING OVERLAY -->
        <div class="loading-overlay hidden" id="loadingOverlay">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>

    </div><!-- dashboardWrapper -->

    <script src="/app.js"></script>
</body>

</html>